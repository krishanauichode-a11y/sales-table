<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Sales Lead Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"/>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css"/>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"/>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      /* ================= ROOT VARIABLES ================= */
      :root {
        --primary: #1e3a8a;
        --primary-dark: #1e2b5c;
        --primary-light: #e0e7ff;
        --secondary: #4c1d95;
        --secondary-light: #ede9fe;
        --success: #047857;
        --success-light: #d1fae5;
        --warning: #b45309;
        --warning-light: #fef3c7;
        --danger: #b91c1c;
        --danger-light: #fee2e2;
        --info: #0e7490;
        --info-light: #cffafe;

        --gray-50: #f8fafc;
        --gray-100: #f1f5f9;
        --gray-200: #e2e8f0;
        --gray-300: #cbd5e1;
        --gray-400: #94a3b8;
        --gray-500: #64748b;
        --gray-600: #475569;
        --gray-700: #334155;
        --gray-800: #1e293b;
        --gray-900: #0f172a;

        --radius: 16px;
        --radius-sm: 8px;
        --radius-lg: 24px;

        --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
        --shadow-md:
          0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        --shadow-lg:
          0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
        --shadow-xl:
          0 20px 25px -5px rgba(0, 0, 0, 0.1),
          0 10px 10px -5px rgba(0, 0, 0, 0.04);

        --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        --transition-fast: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
      }

      /* ================= RESET ================= */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          "Inter",
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          Roboto,
          Oxygen,
          Ubuntu,
          Cantarell,
          "Open Sans",
          "Helvetica Neue",
          sans-serif;
        background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
        color: var(--gray-800);
        min-height: 100vh;
        line-height: 1.6;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }

      /* ================= DASHBOARD CONTAINER ================= */
      .dashboard-container {
        display: block; /* Visible by default since login is removed */
      }

      /* ================= LOGOUT BUTTON ================= */
      .logout-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        z-index: 1000;
        background: #1e3a8a;
        border: 1px solid var(--gray-200);
        color: white;
        padding: 8px 16px;
        border-radius: var(--radius-sm);
        font-weight: 500;
        display: flex;
        align-items: center;
        gap: 6px;
        transition: var(--transition);
        margin-top: 45px;
      }

      .logout-btn:hover {
        background: rgb(6, 28, 102);
        color: white;
        box-shadow: var(--shadow-md);
      }

      /* ================= ORIGINAL DASHBOARD STYLES ================= */
      .dashboard-header {
        background: white;
        padding: 28px 0;
        margin-bottom: 32px;
        box-shadow: var(--shadow-sm);
        border-bottom: 1px solid var(--gray-200);
        position: relative;
        overflow: hidden;
      }

      .dashboard-header::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
      }

      .dashboard-title {
        text-align: center;
        font-size: 2.5rem;
        font-weight: 800;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        letter-spacing: -0.02em;
        position: relative;
      }

      .dashboard-title::after {
        content: "";
        position: absolute;
        bottom: -10px;
        left: 50%;
        transform: translateX(-50%);
        width: 80px;
        height: 4px;
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        border-radius: 2px;
      }

      /* ================= ACTION BAR ================= */
      .action-bar {
        background: white;
        padding: 24px;
        border-radius: var(--radius-lg);
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        margin-bottom: 32px;
        box-shadow: var(--shadow-md);
        border: 1px solid var(--gray-200);
        position: relative;
        overflow: hidden;
        margin-top: 100px;
        /* Since buttons were removed, we can just center the title or hide this bar if empty. 
           Keeping it to maintain layout structure if needed later, or we can hide it. 
           The title is inside the dashboard-header, so this bar is currently empty. 
           I will hide it since all actions were removed. */
        display: none; 
      }

      /* ================= BUTTONS (Kept for potential reuse but hidden from request) ================= */
      .btn-modern {
        padding: 14px 24px;
        border-radius: var(--radius-sm);
        font-size: 15px;
        font-weight: 600;
        display: inline-flex;
        align-items: center;
        gap: 8px;
        border: none;
        cursor: pointer;
        transition: var(--transition);
        position: relative;
        overflow: hidden;
        letter-spacing: 0.025em;
      }

      .btn-modern::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255, 255, 255, 0.2);
        transform: translate(-50%, -50%);
        transition:
          width 0.6s,
          height 0.6s;
      }

      .btn-modern:active::before {
        width: 300px;
        height: 300px;
      }

      .btn-modern:active {
        transform: scale(0.96);
      }

      .btn-primary-modern {
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        color: white;
        box-shadow: 0 4px 6px -1px rgba(30, 58, 138, 0.3);
      }

      .btn-primary-modern:hover {
        background: linear-gradient(135deg, var(--primary-dark), #1e2b5c);
        transform: translateY(-2px);
        box-shadow: 0 10px 15px -3px rgba(30, 58, 138, 0.3);
      }

      /* ================= CAROUSEL ================= */
      .carousel-container {
        background: white;
        border-radius: var(--radius-lg);
        overflow: hidden;
        box-shadow: var(--shadow-lg);
        margin-bottom: 40px;
        border: 1px solid var(--gray-200);
      }

      .carousel-control-prev,
      .carousel-control-next {
        display: none !important;
      }

      /* ================= INDICATORS ================= */
      .carousel-indicators-custom {
        display: flex;
        justify-content: center;
        gap: 10px;
        padding: 20px;
        background: var(--gray-50);
        border-bottom: 1px solid var(--gray-200);
      }

      .indicator-dot {
        width: 40px;
        height: 8px;
        background: var(--gray-300);
        border-radius: 4px;
        border: none;
        cursor: pointer;
        opacity: 0.6;
        transition: var(--transition);
        position: relative;
      }

      .indicator-dot:hover {
        opacity: 0.8;
      }

      .indicator-dot.active {
        background: linear-gradient(90deg, var(--primary), var(--secondary));
        opacity: 1;
        width: 60px;
      }

      /* ================= CARDS ================= */
      .dashboard-card {
        background: white;
        border-radius: 0;
        overflow: hidden;
      }

      .card-header-custom {
        padding: 20px 24px;
        font-size: 1.25rem;
        font-weight: 700;
        background: linear-gradient(
          135deg,
          var(--primary),
          var(--primary-dark)
        );
        color: white;
        display: flex;
        align-items: center;
        gap: 12px;
        position: relative;
        overflow: hidden;
        justify-content: center;
      }

      .card-header-custom::after {
        content: "";
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--secondary), var(--primary));
        opacity: 0.7;
      }

      .card-header-custom i {
        font-size: 1.4rem;
      }

      .card-body-custom {
        padding: 28px 24px;
      }

      /* ================= TABLE ================= */
      .table-container {
        overflow-x: auto;
        border-radius: var(--radius-sm);
        box-shadow: var(--shadow-sm);
      }

      .table-modern {
        width: 100%;
        border-collapse: collapse;
        border: 2px solid black;
      }

      .table-modern thead th {
        background: var(--gray-100);
        color: var(--gray-700);
        font-size: 17px;
        font-weight: 700;
        text-transform: uppercase;
        padding: 16px 12px;
        border: 1px solid black;
        border-bottom: 2px solid black;
        text-align: center;
        letter-spacing: 0.025em;
        position: sticky;
        top: 0;
        z-index: 10;
      }

      .table-modern td {
        padding: 14px 12px;
        font-size: 18px;
        text-align: center;
        border: 1px solid black;
        border-bottom: 1px solid black;
        transition: var(--transition-fast);
      }

      .table-modern tbody tr:hover {
        background: var(--gray-50);
      }

      .table-modern tbody tr:hover td {
        color: var(--gray-900);
        border: 1px solid black;
      }

      /* ================= STICKY NAME COLUMN ================= */
      .name-cell {
        position: sticky;
        left: 0;
        z-index: 5;
        background: linear-gradient(90deg, #f8fafc 0%, #ffffff 100%);
        text-align: left !important;
        padding-left: 16px !important;
        font-weight: 600;
        color: var(--gray-800) !important;
        box-shadow: 2px 0 5px rgba(0, 0, 0, 0.05);
        border: 1px solid black !important;
      }

      /* ================= NON-EDITABLE CELLS ================= */
      .view-only-cell {
        transition: var(--transition-fast);
        border: 1px solid black !important;
      }

      .view-only-cell:hover {
        background: var(--gray-50);
        color: var(--gray-900);
        border: 1px solid black !important;
      }

      /* ================= NON-EDITABLE HEADERS ================= */
      .view-only-header {
        transition: var(--transition-fast);
        background: var(--gray-100);
        border: 1px solid black !important;
      }

      .view-only-header:hover {
        background: var(--gray-200);
        color: var(--gray-700);
        border: 1px solid black !important;
      }

      /* ================= TOTAL / FOOTER ================= */
      .total-cell {
        font-weight: 700;
        color: var(--primary);
        background: var(--primary-light) !important;
        border: 1px solid rgb(30, 10, 87) !important;
      }

      .current-month {
        background-color: rgba(30, 58, 138, 0.1) !important;
        border: 2px solid var(--primary) !important;
      }

      .table-footer td {
        background: var(--gray-50);
        font-weight: 700;
        border-top: 2px solid black;
        border: 1px solid black;
        padding: 16px 12px;
      }

      /* ================= LOADING ================= */
      .loading-overlay {
        position: fixed;
        inset: 0;
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(4px);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999;
      }

      .spinner-modern {
        width: 50px;
        height: 50px;
        border: 4px solid var(--gray-200);
        border-top: 4px solid var(--primary);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* ================= NOTIFICATION ================= */
      .notification {
        position: fixed;
        top: 24px;
        right: 24px;
        min-width: 300px;
        padding: 16px 20px;
        border-radius: var(--radius-sm);
        display: flex;
        align-items: center;
        gap: 12px;
        color: white;
        box-shadow: var(--shadow-xl);
        z-index: 10000;
        animation: slideIn 0.3s ease-out;
        border-left: 4px solid rgba(255, 255, 255, 0.3);
      }

      .notification-success {
        background: linear-gradient(135deg, var(--success), #065f46);
      }
      .notification-error {
        background: linear-gradient(135deg, var(--danger), #991b1b);
      }
      .notification-warning {
        background: linear-gradient(135deg, var(--warning), #92400e);
      }

      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }

      /* ================= SELECT ================= */
      .select-modern {
        padding: 10px 14px;
        font-size: 15px;
        border-radius: var(--radius-sm);
        border: 2px solid var(--gray-200);
        background: white;
        cursor: pointer;
        transition: var(--transition);
        min-width: 180px;
        font-weight: 500;
      }
      .select-modern:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.15);
      }
      .select-modern:hover {
        border-color: var(--gray-300);
      }

      /* ================= BATCH CONTAINERS ================= */
      .batch-selection-container {
        background: var(--gray-50);
        border-radius: var(--radius-sm);
        padding: 16px;
        margin-bottom: 20px;
        border: 1px solid var(--gray-200);
      }
      .batch-selection-title {
        font-weight: 600;
        color: var(--gray-700);
        margin-bottom: 10px;
        font-size: 16px;
      }
      .batch-selection-form {
        display: flex;
        gap: 12px;
        align-items: center;
        flex-wrap: wrap;
        padding-bottom: 10px;
      }
      .batch-select {
        flex: 1;
        min-width: 200px;
      }
      .batch-btn {
        white-space: nowrap;
      }
      .batch-info-badge {
        display: inline-block;
        padding: 6px 12px;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        color: white;
        border-radius: var(--radius-sm);
        font-size: 14px;
        font-weight: 600;
        margin-left: 12px;
        box-shadow: var(--shadow-sm);
      }
      .year-selector-container {
        background: var(--gray-50);
        border-radius: var(--radius-sm);
        padding: 16px;
        margin-bottom: 20px;
        border: 1px solid var(--gray-200);
      }
      .year-selector-title {
        font-weight: 600;
        color: var(--gray-700);
        margin-bottom: 10px;
        font-size: 16px;
        text-align: center;
      }
      .year-selector-form {
        display: flex;
        gap: 12px;
        justify-content: center;
        flex-wrap: wrap;
      }
      .year-select {
        min-width: 150px;
      }

      /* ================= CHART CONTAINERS ================= */
      .charts-container {
        display: flex;
        gap: 20px;
        margin-top: 20px;
      }
      .chart-wrapper {
        flex: 1;
        min-width: 0;
      }
      .chart-title {
        text-align: center;
        font-weight: 600;
        color: var(--gray-700);
        margin-bottom: 10px;
        font-size: 14px;
      }
      .chart-container {
        position: relative;
        height: 300px;
        width: 100%;
        background: white;
        border-radius: var(--radius-sm);
        padding: 10px;
        box-shadow: var(--shadow-sm);
      }
      .pie-chart-container {
        position: relative;
        height: 380px !important;
        width: 100%;
        background: white;
        border-radius: var(--radius-sm);
        padding: 15px;
        box-shadow: var(--shadow-sm);
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .bar-chart-container {
        position: relative;
        height: 300px;
        width: 100%;
        background: white;
        border-radius: var(--radius-sm);
        padding: 10px;
        box-shadow: var(--shadow-sm);
      }
      .form-control-modern {
        width: 100%;
        padding: 14px 16px;
        font-size: 15px;
        border-radius: var(--radius-sm);
        border: 2px solid var(--gray-200);
        transition: var(--transition);
        background-color: white;
      }

      .form-control-modern:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.15);
      }
    </style>
  </head>
  <body>

    <!-- DASHBOARD (VISIBLE BY DEFAULT) -->
    <div class="dashboard-container" id="dashboardContainer">
     

      <nav class="navbar navbar-expand-lg bg-body-tertiary py-3 fixed-top">
        <div class="container justify-content-center">
          <!-- Mobile Logo -->
          <a class="navbar-brand d-block d-md-none text-center" href="#">
            <img src="image/logo.png" alt="Logo" class="img-fluid" style="max-width:150px;">
          </a>

          <!-- Desktop Logo -->
          <a class="navbar-brand d-none d-md-block text-center" href="#">
            <img src="image/logo.png" alt="Logo" class="img-fluid" style="max-width:30%;">
          </a>
        </div>
      </nav>

      <div class="loading-overlay" id="loadingOverlay" style="display: none">
        <div class="spinner-modern"></div>
      </div>
      <div class="dashboard-header">
        <div class="container-fluid">
          <!-- Action Bar Hidden as all buttons were requested to be removed -->
          <div class="action-bar"></div>

          <h1 class="dashboard-title">Sales Lead Management Dashboard</h1>
        </div>
      </div>
      <div class="container-fluid">
        <div class="carousel-container">
          <div
            id="salesCarousel"
            class="carousel slide"
            data-bs-ride="carousel"
            data-bs-interval="10000"
            data-bs-pause="hover"
            data-bs-touch="true"
          >
            <!-- Indicators Updated to 5 slides (0-4) -->
            <div class="carousel-indicators-custom">
              <button class="indicator-dot active" data-bs-target="#salesCarousel" data-bs-slide-to="0"></button>
              <button class="indicator-dot" data-bs-target="#salesCarousel" data-bs-slide-to="1"></button>
              <button class="indicator-dot" data-bs-target="#salesCarousel" data-bs-slide-to="2"></button>
              <button class="indicator-dot" data-bs-target="#salesCarousel" data-bs-slide-to="3"></button>
              <button class="indicator-dot" data-bs-target="#salesCarousel" data-bs-slide-to="4"></button>
            </div>
            <div class="carousel-inner">
              
              <!-- Slide 1: Daily Lead Performance -->
              <div class="carousel-item active">
                <div class="dashboard-card">
                  <div class="card-header-custom">
                    <div><i class="bi bi-calendar3"></i> <span>Daily Lead Performance</span></div>
                  </div>
                  <div class="card-body-custom">
                    <div class="d-flex justify-content-center mb-4">
                      <select id="monthSelect" class="select-modern" onchange="renderDaily()">
                        <option value="0">January</option>
                        <option value="1">February</option>
                        <option value="2">March</option>
                        <option value="3">April</option>
                        <option value="4">May</option>
                        <option value="5">June</option>
                        <option value="6">July</option>
                        <option value="7">August</option>
                        <option value="8">September</option>
                        <option value="9">October</option>
                        <option value="10">November</option>
                        <option value="11">December</option>
                      </select>
                    </div>
                    <div class="table-container">
                      <table class="table-modern">
                        <thead><tr id="dailyHead"></tr></thead>
                        <tbody id="dailyBody"></tbody>
                        <tfoot id="dailyFooter" class="table-footer"></tfoot>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Slide 2: Monthly Lead Performance -->
              <div class="carousel-item">
                <div class="dashboard-card">
                  <div class="card-header-custom">
                    <div>
                      <i class="bi bi-graph-up-arrow"></i> 
                      <span>Monthly Lead Performance</span>
                      <span id="summaryBatchBadge" class="batch-info-badge" style="display: none;">All Batches</span>
                    </div>
                  </div>
                  <div class="card-body-custom">
                    <div class="batch-selection-container">
                      <div class="row">
                        <div class="col-12 col-md-12 col-lg-12">
                          <div class="batch-selection-title">Batch Selection for Lead Performance</div>
                          <div class="batch-selection-form">
                            <select id="summaryBatchSelect" class="select-modern batch-select" onchange="renderSummary()">
                              <option value="0">8 March</option>
                              <option value="1">6 April</option>
                              <option value="2">10 May</option>
                            </select>
                            <button class="btn-modern btn-primary-modern batch-btn" onclick="applyBatchSelection()">
                              <i class="bi bi-calendar-check"></i> Apply Batch
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="table-container">
                      <table class="table-modern">
                        <thead><tr id="summaryHead"></tr></thead>
                        <tbody id="summaryBody"></tbody>
                        <tfoot id="summaryFooter" class="table-footer"></tfoot>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Slide 3: Month Wise Business Performance -->
              <div class="carousel-item">
                <div class="dashboard-card">
                  <div class="card-header-custom">
                    <div>
                      <i class="bi bi-calendar-month"></i> 
                      <span>Month Wise Business Performance</span>
                      <span id="monthlyBatchBadge" class="batch-info-badge" style="display: none;">All Batches</span>
                    </div>
                  </div>
                  <div class="card-body-custom">
                    <div class="batch-selection-container">
                      <div class="batch-selection-title">Select Month to Highlight</div>
                      <div class="batch-selection-form">
                        <select id="monthlyMonthSelect" class="select-modern batch-select" onchange="renderMonthly()">
                          <option value="0">January</option>
                          <option value="1">February</option>
                          <option value="2">March</option>
                          <option value="3">April</option>
                          <option value="4">May</option>
                          <option value="5">June</option>
                          <option value="6">July</option>
                          <option value="7">August</option>
                          <option value="8">September</option>
                          <option value="9">October</option>
                          <option value="10">November</option>
                          <option value="11">December</option>
                        </select>
                      </div>
                    </div>
                    <div class="table-container">
                      <table class="table-modern">
                        <thead><tr id="monthlyHead"></tr></thead>
                        <tbody id="monthlyBody"></tbody>
                        <tfoot id="monthlyFooter" class="table-footer"></tfoot>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Slide 4: Lead Distribution Panel -->
              <div class="carousel-item">
                <div class="dashboard-card">
                  <div class="card-header-custom">
                    <div><i class="bi bi-people"></i> <span>Lead Distribution Panel</span></div>
                  </div>
                  <div class="card-body-custom">
                    <div class="table-container">
                      <table class="table-modern">
                        <thead><tr id="batchHead"></tr></thead>
                        <tbody id="batchBody"></tbody>
                        <tfoot id="batchFooter" class="table-footer"></tfoot>
                      </table>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Slide 5: (Formerly Slide 6) Monthly Webinar Lead Admin -->
              <div class="carousel-item">
                <div class="dashboard-card">
                  <div class="card-header-custom">
                    <div><i class="bi bi-bar-chart-fill"></i> <span>Monthly Webinar Lead Admin</span></div>
                  </div>
                  <div class="card-body-custom">
                    <div class="year-selector-container">
                      <div class="year-selector-title">Select Year for Webinar Leads</div>
                      <div class="year-selector-form">
                        <select id="webinarYearSelect" class="select-modern year-select" onchange="updateWebinarYear()">
                          <option value="2025">2025</option>
                          <option value="2026">2026</option>
                          <option value="2027">2027</option>
                          <option value="2028">2028</option>
                          <option value="2029">2029</option>
                          <option value="2030">2030</option>
                        </select>
                        <span class="batch-info-badge" id="currentYearBadge">2025</span>
                      </div>
                    </div>
                    
                    <div class="batch-selection-container mt-3">
                      <div class="batch-selection-title">Webinar Analytics Dashboard</div>
                    </div>
                    
                    <hr class="my-4" />
                    
                    <div class="charts-container">
                      <div class="chart-wrapper">
                        <div class="chart-title">Lead Distribution by Batch</div>
                        <div class="pie-chart-container">
                          <canvas id="webinarPieChart"></canvas>
                        </div>
                      </div>
                      <div class="chart-wrapper">
                        <div class="chart-title">Batch Lead Count</div>
                        <div class="bar-chart-container">
                          <canvas id="webinarBarChart"></canvas>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      /* ================= SALES DASHBOARD ================= */
      const API_URL = "https://tables-h7u9.onrender.com/api";
      let salesData = { employees: [], dailyBookings: {}, leadSummary: {}, monthlyLeads: {} };
      let batchData = { employees: [], batches: [], batchLeads: {}, thc: {} };
      let monthlyBatchData = [];
      let webinarMonthlyLeads = {}; 
      let webinarData = {}; 
      let customHeaders = {
        daily: [], 
        summary: ["Team Member", "Fresher", "Offer", "Repeater", "Family","TOTAL", "Attended", "Postponed"], 
        monthly: ["Team Member"], 
        batch: ["Team Member"], 
        batchTable: ["Team Member"],
      };
      let currentBatchFilter = "all";
      let currentMonthlyBatchFilter = "all";
      let currentSummaryMonth = new Date().getMonth();
      let currentMonthlyMonth = new Date().getMonth();
      let currentWebinarYear = "2025"; 
      let employeeBatches = {};
      
      let batchToMonthMapping = [
        { batchIndex: 0, batchName: "8 March", monthIndex: 2, monthName: "March" },
        { batchIndex: 1, batchName: "6 April", monthIndex: 3, monthName: "April" },
        { batchIndex: 2, batchName: "10 May", monthIndex: 4, monthName: "May" }
      ];

      function showLoading() { document.getElementById("loadingOverlay").style.display = "flex"; }
      function hideLoading() { document.getElementById("loadingOverlay").style.display = "none"; }
      function showNotification(message, type = "success") {
        const notification = document.createElement("div");
        notification.className = `notification notification-${type} fade-in`;
        notification.innerHTML = `<i class="bi bi-${type === "success" ? "check-circle" : type === "error" ? "x-circle" : "info-circle"}"></i><span>${message}</span>`;
        document.body.appendChild(notification);
        setTimeout(() => { notification.style.animation = "slideIn 0.3s ease-out reverse"; setTimeout(() => notification.remove(), 300); }, 3000);
      }

      // --- CORE DATA FUNCTIONS ---
      async function fetchData() {
        try {
          showLoading();
          const response = await fetch(`${API_URL}/sales`);
          if (!response.ok) throw new Error("Network response was not ok");
          const data = await response.json();
          salesData.employees = data.employees || [];
          salesData.dailyBookings = data.dailyBookings || {};
          salesData.leadSummary = data.leadSummary || {};
          salesData.monthlyLeads = data.monthlyLeads || {};
          batchData = data.batchData || { employees: [], batches: [], batchLeads: {}, thc: {} };
          monthlyBatchData = [];
          if (data.monthlyBatchAdmin) {
            for (const name in data.monthlyBatchAdmin) {
              const leadsArray = data.monthlyBatchAdmin[name];
              const paddedLeads = Array(15).fill(0).map((_, i) => leadsArray[i] || 0);
              monthlyBatchData.push({ name, leads: paddedLeads });
            }
          }
          customHeaders = data.customHeaders || customHeaders;
          
          if (data.webinarLeads) {
            if (typeof data.webinarLeads === 'object' && !Array.isArray(data.webinarLeads)) {
              if (Object.keys(data.webinarLeads)[0] && !isNaN(Object.keys(data.webinarLeads)[0])) {
                webinarMonthlyLeads = data.webinarLeads;
              } else {
                webinarMonthlyLeads = {};
                webinarMonthlyLeads[currentWebinarYear] = data.webinarLeads;
              }
            } else {
              webinarMonthlyLeads = {};
              webinarMonthlyLeads[currentWebinarYear] = {};
            }
          } else {
            webinarMonthlyLeads = {};
            webinarMonthlyLeads[currentWebinarYear] = {};
          }
          
          if (data.webinarData) {
            webinarData = data.webinarData;
          } else {
            webinarData = {};
            initializeDefaultWebinarBatches();
          }
          
          employeeBatches = data.employeeBatches || {};
          
          if (data.batchToMonthMapping) {
            batchToMonthMapping = data.batchToMonthMapping;
          }
          
          salesData.employees.forEach(emp => {
            if (!salesData.leadSummary[emp]) {
              salesData.leadSummary[emp] = {};
              for(let i = 0; i < 12; i++) {
                salesData.leadSummary[emp][i] = { pre: 0, off: 0, rep: 0, app: 0, att: 0 };
              }
            }
          });

          renderAll();
          renderWebinarCharts();
          updateBatchDropdown();
        } catch (error) {
          console.error("Error fetching data:", error);
          showNotification("Failed to load data.", "error");
        } finally {
          hideLoading();
        }
      }

      // --- BATCH MANAGEMENT FUNCTIONS ---
      function updateBatchDropdown() {
        const dropdown = document.getElementById("summaryBatchSelect");
        if(!dropdown) return;
        
        dropdown.innerHTML = "";
        
        batchToMonthMapping.forEach(batch => {
          const option = document.createElement("option");
          option.value = batch.batchIndex;
          option.textContent = batch.batchName;
          dropdown.appendChild(option);
        });
        
        if (currentSummaryMonth !== null && currentSummaryMonth < batchToMonthMapping.length) {
          dropdown.value = currentSummaryMonth;
        }
      }

      // --- WEBINAR BATCH MANAGEMENT ---
      function initializeDefaultWebinarBatches() {
        if (!webinarData[currentWebinarYear]) {
          webinarData[currentWebinarYear] = {};
        }
        if (Object.keys(webinarData[currentWebinarYear]).length === 0) {
           const defaultBatches = ["Q1", "Q2", "Q3", "Q4"]; 
           defaultBatches.forEach(batch => { webinarData[currentWebinarYear][batch] = 0; });
        }
      }

      function updateWebinarYear() {
        const yearSelect = document.getElementById("webinarYearSelect");
        currentWebinarYear = yearSelect.value;
        document.getElementById("currentYearBadge").textContent = currentWebinarYear;
        
        if (!webinarData[currentWebinarYear]) {
          webinarData[currentWebinarYear] = {};
          initializeDefaultWebinarBatches();
        }
        
        renderWebinarCharts();
        showNotification(`Switched to ${currentWebinarYear} webinar data`, "success");
      }

      // --- RENDER FUNCTIONS ---
      function daysInMonth(month) { return new Date(new Date().getFullYear(), month + 1, 0).getDate(); }
      function renderDaily() {
        const month = +monthSelect.value; const days = daysInMonth(month);
        if (customHeaders.daily.length === 0) { customHeaders.daily.push("Team Member"); for (let d = 1; d <= 31; d++) { customHeaders.daily.push(d.toString()); } customHeaders.daily.push("TOTAL"); }
        dailyHead.innerHTML = `<th class="name-cell view-only-header">${customHeaders.daily[0]}</th>`;
        for (let d = 1; d <= days; d++) { dailyHead.innerHTML += `<th class="view-only-header">${customHeaders.daily[d] || d}</th>`; }
        dailyHead.innerHTML += `<th class="total-cell view-only-header">${customHeaders.daily[days + 1] || "TOTAL"}</th>`;
        dailyBody.innerHTML = "";
        salesData.employees.forEach((emp) => {
          if (!salesData.dailyBookings[emp][month]) salesData.dailyBookings[emp][month] = {};
          let total = 0; let row = `<tr><td class="name-cell">${emp}</td>`;
          for (let d = 1; d <= days; d++) {
            const val = salesData.dailyBookings[emp][month][d] || ""; total += Number(val || 0);
            row += `<td class="view-only-cell">${val}</td>`;
          }
          row += `<td class="total-cell">${total}</td></tr>`; dailyBody.innerHTML += row;
        });
        dailyFooter.innerHTML = ""; let totalRow = `<tr><td class="name-cell">TOTAL</td>`; let grandTotal = 0;
        for (let d = 1; d <= days; d++) {
          let dayTotal = 0; salesData.employees.forEach((emp) => { dayTotal += Number(salesData.dailyBookings[emp][month][d] || 0); });
          grandTotal += dayTotal; totalRow += `<td class="total-cell">${dayTotal}</td>`;
        }
        totalRow += `<td class="total-cell">${grandTotal}</td></tr>`; dailyFooter.innerHTML += totalRow;
      }
      
      function renderSummary() {
        const batchSelect = document.getElementById("summaryBatchSelect");
        if (batchSelect) {
          currentSummaryMonth = parseInt(batchSelect.value);
        }
        
        summaryHead.innerHTML = `<th class="name-cell view-only-header">${customHeaders.summary[0]}</th>`;
        for (let i = 1; i < customHeaders.summary.length - 1; i++) { 
          summaryHead.innerHTML += `<th class="view-only-header">${customHeaders.summary[i]}</th>`; 
        }
        summaryHead.innerHTML += `<th class="total-cell view-only-header">${customHeaders.summary[customHeaders.summary.length - 1]}</th>`;
        summaryBody.innerHTML = "";
        
        let employeesToShow = salesData.employees;
        if (currentBatchFilter !== "all") {
          employeesToShow = salesData.employees.filter(emp => employeeBatches[emp] === currentBatchFilter);
        }
        
        employeesToShow.forEach((emp) => {
          const s = salesData.leadSummary[emp][currentSummaryMonth] || { 
            pre: 0, 
            off: 0, 
            rep: 0, 
            app: 0, 
            att: 0 
          };
          const total = s.pre + s.off + s.rep + s.app;
          const postponed = Math.max(0, total - s.att);
          let row = `<tr><td class="name-cell">${emp}</td>`;
          row += `<td class="view-only-cell">${s.pre}</td>`;
          row += `<td class="view-only-cell">${s.off}</td>`;
          row += `<td class="view-only-cell">${s.rep}</td>`;
          row += `<td class="view-only-cell">${s.app}</td>`;
          row += `<td class="total-cell">${total}</td>`;
          row += `<td class="view-only-cell">${s.att}</td>`;
          row += `<td class="total-cell">${postponed}</td>`;
          row += `</tr>`;
          summaryBody.innerHTML += row;
        });
        
        summaryFooter.innerHTML = ""; 
        let totalRow = `<tr><td class="name-cell">TOTAL</td>`; 
        
        let grandTotal = 0;
        let grandAttended = 0;
        
        // FAMILY totals (pre, off, rep, app)
        ["pre", "off", "rep", "app"].forEach((key) => {
          let columnTotal = 0; 
          
          employeesToShow.forEach((emp) => { 
            columnTotal += Number(
              salesData.leadSummary[emp][currentSummaryMonth]?.[key] || 0
            ); 
          });
          
          grandTotal += columnTotal; 
          totalRow += `<td class="total-cell">${columnTotal}</td>`;
        });
        
        // TOTAL column (after family)
        totalRow += `<td class="total-cell">${grandTotal}</td>`;
        
        // Calculate attended total
        employeesToShow.forEach((emp) => { 
          grandAttended += Number(
            salesData.leadSummary[emp][currentSummaryMonth]?.att || 0
          ); 
        });
        
        // ATTENDED column
        totalRow += `<td class="total-cell">${grandAttended}</td>`;
        
        // POSTPONED column (after attended)
        const grandPostponed = Math.max(0, grandTotal - grandAttended);
        totalRow += `<td class="total-cell">${grandPostponed}</td>`;
        
        totalRow += `</tr>`;
        
        summaryFooter.innerHTML += totalRow;
      }

      function applyBatchSelection() {
        const batchSelect = document.getElementById("summaryBatchSelect");
        const selectedBatchIndex = parseInt(batchSelect.value);
        
        const batchMapping = batchToMonthMapping.find(b => b.batchIndex === selectedBatchIndex);
        
        if (!batchMapping) {
          showNotification("Invalid batch selection", "error");
          return;
        }
        
        const targetMonth = batchMapping.monthIndex;
        const batchName = batchMapping.batchName;
        const monthName = batchMapping.monthName;
        
        currentSummaryMonth = selectedBatchIndex;
        
        salesData.employees.forEach(emp => {
          const summary = salesData.leadSummary[emp][selectedBatchIndex] || { pre: 0, off: 0, rep: 0, app: 0, att: 0 };
          let totalLeads = 0;
          
          if (summary.pre > 0) {
            totalLeads += summary.pre * 1;
          }
          
          if (summary.off >= 2) {
            totalLeads += Math.floor(summary.off / 2) * 1;
          }
          
          if (summary.app >= 2) {
            totalLeads += Math.floor(summary.app / 2) * 1;
          }
          
          salesData.monthlyLeads[emp][targetMonth] = totalLeads;
        });
        
        document.getElementById('monthlyMonthSelect').value = targetMonth;
        currentMonthlyMonth = targetMonth;
        
        renderSummary();
        renderMonthly();
        
        showNotification(`${batchName} batch leads calculated and updated in ${monthName} month!`, "success");
      }
      
      function renderMonthly() {
        const monthSelect = document.getElementById("monthlyMonthSelect");
        if (monthSelect) {
          currentMonthlyMonth = parseInt(monthSelect.value);
        }

        if (customHeaders.monthly.length === 1) { const months = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"]; customHeaders.monthly = [...customHeaders.monthly, ...months, "TOTAL"]; }
        monthlyHead.innerHTML = `<th class="name-cell view-only-header">${customHeaders.monthly[0]}</th>`;
        for (let i = 1; i < customHeaders.monthly.length - 1; i++) { monthlyHead.innerHTML += `<th class="view-only-header">${customHeaders.monthly[i]}</th>`; }
        monthlyHead.innerHTML += `<th class="total-cell view-only-header">${customHeaders.monthly[customHeaders.monthly.length - 1]}</th>`;
        monthlyBody.innerHTML = "";
        
        let employeesToShow = salesData.employees;
        if (currentMonthlyBatchFilter !== "all") {
          employeesToShow = salesData.employees.filter(emp => employeeBatches[emp] === currentMonthlyBatchFilter);
        }
        
        employeesToShow.forEach((emp) => {
          let total = 0; let row = `<tr><td class="name-cell">${emp}</td>`;
          salesData.monthlyLeads[emp].forEach((v, i) => {
            total += Number(v || 0);
            const isCurrentMonth = i === currentMonthlyMonth;
            const cellClass = isCurrentMonth ? "view-only-cell current-month" : "view-only-cell";
            row += `<td class="${cellClass}">${v}</td>`;
          });
          row += `<td class="total-cell">${total}</td></tr>`; monthlyBody.innerHTML += row;
        });
        monthlyFooter.innerHTML = ""; let totalRow = `<tr><td class="name-cell">TOTAL</td>`; let grandTotal = 0;
        for (let m = 0; m < 12; m++) {
          let monthTotal = 0; 
          employeesToShow.forEach((emp) => { monthTotal += Number(salesData.monthlyLeads[emp][m] || 0); });
          grandTotal += monthTotal;
          const isCurrentMonth = m === currentMonthlyMonth;
          const cellClass = isCurrentMonth ? "total-cell current-month" : "total-cell";
          totalRow += `<td class="${cellClass}">${monthTotal}</td>`;
        }
        totalRow += `<td class="total-cell">${grandTotal}</td></tr>`; monthlyFooter.innerHTML += totalRow;
      }
      
      function renderBatch() {
        if (customHeaders.batch.length === 1) { batchData.batches.forEach((b) => customHeaders.batch.push(b.label)); customHeaders.batch.push("TOTAL"); }
        batchHead.innerHTML = `<th class="name-cell view-only-header">${customHeaders.batch[0]}</th>`;
        for (let i = 1; i < customHeaders.batch.length - 1; i++) { batchHead.innerHTML += `<th class="view-only-header">${customHeaders.batch[i]}</th>`; }
        batchHead.innerHTML += `<th class="total-cell view-only-header">${customHeaders.batch[customHeaders.batch.length - 1]}</th>`;
        batchBody.innerHTML = "";
        salesData.employees.forEach((emp) => {
          let total = 0; let row = `<tr><td class="name-cell">${emp}</td>`;
          batchData.batches.forEach((b) => {
            const val = batchData.batchLeads[emp][b.id] || 0; total += Number(val || 0);
            row += `<td class="view-only-cell">${val}</td>`;
          });
          row += `<td class="total-cell">${total}</td></tr>`; batchBody.innerHTML += row;
        });
        batchFooter.innerHTML = ""; let totalRow = `<tr><td class="name-cell">TOTAL</td>`; let grandTotal = 0;
        batchData.batches.forEach((b) => {
          let sum = 0; salesData.employees.forEach((e) => (sum += Number(batchData.batchLeads[e][b.id] || 0)));
          grandTotal += sum; totalRow += `<td class="total-cell">${sum}</td>`;
        });
        totalRow += `<td class="total-cell">${grandTotal}</td></tr>`; batchFooter.innerHTML += totalRow;
        let thcRow = `<tr><td class="name-cell">T.H.C</td>`; let thcTotal = 0;
        batchData.batches.forEach((b) => {
          const thc = batchData.thc[b.id] || 0; thcTotal += Number(thc || 0);
          thcRow += `<td class="view-only-cell">${thc}</td>`;
        });
        thcRow += `<td class="total-cell">${thcTotal}</td></tr>`; batchFooter.innerHTML += thcRow;
      }
      
      function renderAll() { 
        renderDaily(); 
        renderSummary(); 
        renderMonthly(); 
        renderBatch(); 
      }

      let webinarChart, webinarBarChart;
      
      function renderWebinarCharts() {
        renderWebinarPieChart();
        renderWebinarBarChart();
      }
      
      function renderWebinarPieChart() {
        const ctx = document.getElementById("webinarPieChart");
        
        const currentYearBatches = webinarData[currentWebinarYear] || {};
        const labels = Object.keys(currentYearBatches);
        const data = Object.values(currentYearBatches);
        
        if (webinarChart) {
          webinarChart.destroy();
        }
        
        const colors = [
          "#1e3a8a", "#4c1d95", "#047857", "#b45309", 
          "#0e7490", "#b91c1c", "#64748b", "#0891b2", 
          "#059669", "#d97706", "#dc2626", "#7c3aed",
          "#8b5cf6", "#a855f7", "#c084fc", "#e879f9"
        ];
        
        webinarChart = new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: labels,
            datasets: [{
              data: data,
              backgroundColor: colors.slice(0, labels.length),
              borderWidth: 2,
              borderColor: "#ffffff",
              hoverOffset: 4
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: "65%",
            plugins: {
              legend: {
                position: "right",
                labels: {
                  boxWidth: 12,
                  padding: 10,
                  font: { size: 11 },
                  generateLabels: function(chart) {
                    const data = chart.data;
                    if (data.labels.length && data.datasets.length) {
                      return data.labels.map((label, i) => {
                        const dataset = data.datasets[0];
                        const value = dataset.data[i];
                        
                        return {
                          text: `${label}: ${value}`,
                          fillStyle: dataset.backgroundColor[i],
                          hidden: false,
                          index: i
                        };
                      });
                    }
                    return [];
                  }
                }
              },
              tooltip: {
                backgroundColor: "rgba(0, 0, 0, 0.8)",
                padding: 10,
                titleFont: { size: 13, weight: "bold" },
                bodyFont: { size: 12 },
                callbacks: {
                  label: function(context) {
                    const label = context.label || '';
                    const value = context.raw || 0;
                    return `${label}: ${value} leads`;
                  }
                }
              },
              title: {
                display: true,
                text: `Webinar Leads Distribution - ${currentWebinarYear}`,
                font: { size: 16, weight: "bold" }
              }
            },
            animation: {
              animateScale: true,
              animateRotate: true,
              duration: 1000
            }
          }
        });
      }
      
      function renderWebinarBarChart() {
        const ctx = document.getElementById("webinarBarChart");
        
        const currentYearBatches = webinarData[currentWebinarYear] || {};
        const labels = Object.keys(currentYearBatches);
        const data = Object.values(currentYearBatches);
        
        if (webinarBarChart) {
          webinarBarChart.destroy();
        }
        
        const gradient = ctx.getContext('2d').createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, 'rgba(30, 58, 138, 0.8)');
        gradient.addColorStop(1, 'rgba(30, 58, 138, 0.2)');
        
        webinarBarChart = new Chart(ctx, {
          type: "bar",
          data: {
            labels: labels,
            datasets: [{
              label: "Lead Count",
              data: data,
              backgroundColor: gradient,
              borderColor: "#1e3a8a",
              borderWidth: 2,
              borderRadius: 8,
              hoverBackgroundColor: "#1e3a8a"
            }]
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: "rgba(0, 0, 0, 0.8)",
                padding: 10,
                titleFont: { size: 14, weight: "bold" },
                bodyFont: { size: 12 },
                callbacks: {
                  title: function(context) {
                    return context[0].label;
                  },
                  label: function(context) {
                    return `Leads: ${context.raw}`;
                  }
                }
              },
              title: {
                display: true,
                text: `Webinar Leads by Batch - ${currentWebinarYear}`,
                font: { size: 16, weight: "bold" }
              }
            },
            scales: {
              y: {
                beginAtZero: true,
                grid: { color: "rgba(0, 0, 0, 0.05)" },
                ticks: { font: { size: 11 } },
                title: {
                  display: true,
                  text: "Number of Leads"
                }
              },
              x: {
                grid: { display: false },
                ticks: { font: { size: 11 },
                         maxRotation: 45,
                         minRotation: 45 },
                title: {
                  display: true,
                  text: "Webinar Batch"
                }
              }
            },
            animation: { duration: 1000, easing: "easeInOutQuart" }
          }
        });
      }

      document.addEventListener("DOMContentLoaded", function () {
        // Directly initialize dashboard without login
        fetchData();

        const carousel = document.getElementById("salesCarousel");
        const indicators = document.querySelectorAll(".indicator-dot");

        carousel.addEventListener("slide.bs.carousel", function (event) {
          indicators.forEach(dot => dot.classList.remove("active"));
          indicators[event.to].classList.add("active");
        });
      });
    </script>
  </body>
</html>
